# Notes for developers

As a developer you are invited to read the following.

## Use python Virtual Environments
A Virtual Environment is a tool that allows to create a minimal and customized environment, for every project,
in which only the needed dependecies are installed with the options needed (e.g. the particular version of
the dependency).

### Basic instructions to setup a working virtual environment
1. install virtualenv via pip:

    ```
    pip install virtualenv  
    ```
2. create the virtual environment inside 'venv':

    ```
    cd project_name
    virtualenv  [-p path_to_preferred_interpreter] venv
    ```

3. virtual environment usage:

    To activate the virtual environment:

    ```
    source venv/bin/activate
    ```

    To return to the system's default environment:

    ```
    deactivate
    ```

### Virtual environment for mpm
As mpm uses Scrapy, which is supported under Python 2.7 only, the virtual
environment has to be setup with Python 2.7 as preferred interpreter.

Please also note that .gitignore already contains the directory 'venv' so you may want
use this as a name for the virtual environment.

## Requirements and dependencies
All the requirements and dependencies needed for mpm
are listed inside requirements_dev.txt.

To install them just type:

```
pip install -r requirements_dev.txt
```

To install the mpm module cd to the mpm root directory and type:

```
pip install -e ./
```

## Using py.test
### General testing tips
Unit tests are placed in the **tests** directory, it is advised to split tests for different modules in different test modules.
In order to run the test suite it is sufficient to use the `py.test` runner:
```
py.test tests
```

If `pytest-cov` is installed it is possible to run test coverage reports with the following:
```
py.test --cov mpm tests
```

### Writing tests
It is **STRONGLY** advised to mark tests at least with a unique marker for each module or tested feature;
slow tests should be marked with the `pytest.mark.slowtest` decorator so that they can be excluded when needed.

Currently available markers can be listed with:
```
py.test --markers tests
```
Whenever you create a new marker it is important to add it to the pytest ini file so that others can see the
marker directly from the list generated by *py.test*.


Marked tests can be selected using the *py.test*'s `-m` switch as:
```
py.test -m "mark1 or mark2" tests
```

## Using pylint
Pylint is a static analyzer that can be used to spot common mistakes or bad code styles;
*mpm* provides a configuration file for pylint so that developers can test their code against it.
Keep in mind that, depending on the context, it may be correct to locally disable pylint checks if
considered appropriate by the developer.

Pylint checks can be disabled in the sources using
```
# pylint: disable=<lint-name or lint-id>
```

To run *pylint* towards mpm run:
`pylint mpm`
or
`pylint --report=no mpm`
if you too are annoyed by the report when you only want the messages.

## Git hooks
It is advised to add the pre-commit git hook in order to enforce compliance to the coding style and ensure
code quality upon commit.

The *mpm* project provides hooks in the `hooks` directory, they can be softlinked in your `.git/hooks` in order to be used.
```
ln -sr hooks/pre-commit .git/hooks/pre-commit
```
Make sure that files in `hooks` are runnable.

## Git commit messages style
As a part of the mpm team you should use the following commit message convention:

```
Summary

-thing done #1
- ...
-thing done #n
```

Please note the blank line before the list.

## Documenting the code
Sphinx is used to document the project, it is assumed that the developer is familiar with **restructured text** which is used
in sphinx docs sources.

Whenever some module is modified, make sure that the documentation sources reflect the changes that you made; you will fine the
sources in `docs/source`
In order to generate the documentation use the makefile in `docs`, the most common way is to use the *html* target:
```
make html
```